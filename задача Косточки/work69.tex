 \documentclass [12pt]{article}
\usepackage{amssymb,amsmath, amsthm, amscd,ifthen}
\usepackage[warn]{mathtext}          % русские буквы в формулах, с предупреждением
\usepackage[T2A]{fontenc}
\usepackage[cp1251]{inputenc}
\usepackage[english,russian]{babel}
\usepackage[russian]{babel}
\usepackage[dvips]{graphicx}
\usepackage[hyper]{amsbib}
\usepackage{indentfirst}

%\usepackage{setspace}
%\doublespace

\usepackage{amssymb}
\usepackage[ruled,noline,titlenumbered,linesnumbered,noend,norelsize]{algorithm2e}
\DontPrintSemicolon
\SetNlSty{footnotesize}{}{}
\IncMargin{0.5em}
\SetNlSkip{1em}
\SetKwIF{If}{ElseIf}{Else}{if}{then}{else if}{else}{endif}
\SetKw{Return}{return}
\SetKw{Pick}{pick}
\SetNlSkip{2em}
\newenvironment{algorithm-hbox}{\hbadness=10000\begin{algorithm}}{\end{algorithm}}

\newtheorem{theorem}{Теорема}
\newtheorem{claim}{Утверждение}
\newtheorem{lemma}{Лемма}
\newtheorem{corollary}{Следствие}
\newtheorem{note}{Замечание}
\newtheorem{definition}{Определение}

\textheight232truemm
\textwidth170truemm
\hoffset=-15mm
\voffset=-25mm


\begin{document}
\date{}

\title{Справедливые раскраски гиперграфов в $r$ цветов}
\author{M. Ахмеджанова\footnote{Московский государственный университет имени М.В.Ломоносова, механико-математический факультет; Московский физико-технический институт, лаборатория продвинутой комбинаторики и сетевых приложений}, Д.А. Шабанов\footnote{Московский физико-технический институт, лаборатория продвинутой комбинаторики и сетевых приложений; Математический институт им. В.А. Стеклова Российской академии наук}}
\date{}

\maketitle

\begin{abstract}
	В нашей работе получена оценка на число ребер  $n$-однородного гиперграфа, которая обеспечивает существование  не только правильной раскраски в $r$ цветов, но и справедливой. Раскраска множества вершин гиперграфа называется справедливой (в мировой литературе используется термин equitable), если она является правильной (нет одноцветных ребер) и при этом мощности всех цветовых классов отличаются не более чем на единицу. Данный результат усиливает ранее известную теорему Косточки.
\end{abstract}

\section{Введение} 
\bigskip
В работе рассматривается известная задача экстремальной комбинаторики, связанная с раскрасками гиперграфов.

Дадим основные определения из теории гиперграфов. Гиперграфом называется пара $H = (V, E)$, где $V = V (H)$ --- некоторое множество, называемое множеством вершин гиперграфа, а $E = E(H)$ --- произвольная совокупность подмножеств множества $V$, называемых ребрами гиперграфа. Гиперграф является $n$-однородным, если каждое его ребро содержит ровно $n$ вершин.  

Раскраска множества вершин $V$ гиперграфа $H = (V, E)$ называется правильной, если
в этой раскраске все ребра из $E$ не являются одноцветными.  Если для гиперграфа $H$ существует правильная раскраска в $r$ цветов, то говорят, что $H$ является $r$-раскрашиваемым.

А.Косточка \cite{Kost} доказал следующую теорему: если $r<\sqrt{\frac{1}{8}\ln\frac{ln}{2}}$  и число ребер \\
$n$-однородного гиперграфа $H$ не превосходит

\begin{equation*}
|E|\leq e^{-4r^2}\left(\frac{n}{\ln(n)}\right)^{\lfloor log_{2}(r)/\log_{2}(r)+1\rfloor} r^{n},
\end{equation*}

то $H$ является $r$-раскрашиваемым.

\bigskip
Правильные раскраски  допускают различные обобщения, одним из которых являются справедливые раскраски. Раскраска множества вершин гиперграфа называется \emph{справедливой} (в мировой литературе используется термин \emph{equitable}), если она является правильной и при этом мощности всех цветовых классов отличаются не более, чем на единицу.

Легко показать, что тривиальная оценка $|E|<r^{n-1}$ обеспечивает возможность справедливой раскраски $H$ в $r$ цветов.
Однако, в отличии от правильных раскрасок другие оценки на число ребер авторам неизвестны.

Наш результат сформулирован в следующей теореме:

\begin{theorem}\label{mntheorem}
	Пусть $H=(V,E)$ произвольный $n$-однородный гиперграф c условием
	
	\begin{equation*}
	|E|\leq 0.05\left(\frac{n}{\ln n}\right)^{\lfloor \log_{2}(r)/\log_{2}(r)+1\rfloor} r^{n-1},
	\end{equation*}
    где число цветов $r\leq\sqrt{\frac{\ln n}{-64(\ln c)(\ln \ln n)^3}}$. Тогда для $H$ существует не только правильная, но справедливая раскраска в $r$ цветов.
\end{theorem}

Таким образом, любой $n$-однородный гиперграф с ограниченным  числом ребер допускает не только правильную раскраску в $r$ цветов, но и справедливую. Эта теорема существенно усиливает ранее известный результат.

Возможность справедливо раскрасить можно исследовать не только при ограничении на число ребер, но и при условии, когда ограничены степени вершин гиперграфа. Так, в 1970 году А. Хайнал и Е. Семереди \cite{HajSem} доказали знаменитую гипотезу П. Эрдеша \cite{Erd2}:\emph{ любой граф $G$ с максимальной степенью вершины $\Delta(G)$ допускает не только правильную, но и справедливую раскраску в $\Delta(G)+1$ цветов.}
Позже, доказательство этого фундаментального факта было значительно упрощено X. Киерстедом и А.В. Косточкой \cite{KierKost}, они же совместно с М. Мидларжем и Е. Семереди отыскали \cite{KKMS} быстрый алгоритм для получения искомой справедливой раскраски.

В случае $n$-однородных гиперграфов $\mathcal{H}$ Шабанов \cite{Shab} показал, что для всякого простого  гиперграфа( любые два его ребра имеют не более одной общей вершины) $H\in\mathcal{H}$, а также для всякого гиперграфа $H\in\mathcal{H}$ с большим количеством вершин условие на максимальную степень вершины $\Delta(H):$

\begin{equation*}
\Delta(H)\leq c\cdot 2^{n-1}/\sqrt{n\ln n}
\end{equation*}

обеспечивает возможность справедливой раскраски $H$ в два цвета.
Позже, этот результат был улучшен И. Акользиным \cite{Akol}, который доказал, что для больших $n$ верна оценка:

\begin{equation*}
\Delta(H)\leq c\cdot 2^{n-1}
\end{equation*}

\section{Построение справедливой раскраски: алгоритмы перекраски}
 
Пусть $H=(V,E)$ --- гиперграф из условия теоремы 1. Для удобства будем считать, что число вершин $m$ кратно $r$. Под  сбалансированной раскраской $C=C(K_{1},K_{2},...,K_{r})$ будем понимать некоторое разбиение множества вершин гиперграфа на $r$ равных долей: $V=K_{1}\sqcup K_{2}...\sqcup K_{r}, |K_{1}|=|K_{2}|=...=|K_{r}|$.

\begin{lemma}\label{lemma1}
	Пусть $H=(V,E)$ произвольный $n$-однородный гиперграф, в котором выполнены следующие соотношения:
	\begin{equation*}
	|E|<c\left(\frac{n}{\ln(n)}\right)^{\lfloor \log_{2}(r)/\log_{2}(r)+1\rfloor} r^{n-1},~~~~~~|V|<\frac{n(n-1)(r-1)\lfloor\frac{log_{2}(r)+1}{\log_{2}(r)}\rfloor}{2\ln(n)}.
	\end{equation*}
	Тогда при $c<1$  для $H$ существует справедливая раскраска в $r$ цветов.
\end{lemma}


\begin{proof} Рассмотрим случайную сбалансированную раскраску $C$ гиперграфа $H$. 
	
	Тогда,
	\begin{gather*}
	\Prob(\text{есть одноцветное ребро в $C$})\leq\sum_{e\in E}\frac{r\binom{m-n}{m/r-n}\cdot\binom{m-m/r}{m/r}\cdot...\cdot\binom{m/r}{m/r}}{\binom{m}{m/r}\cdot\binom{m-m/r}{m/r}\cdot...\cdot\binom{m/r}{m/r}}=|E|\frac{r\binom{m-n}{m/r-n}}{\binom{m}{m/r}}=\\
	\\=|E|\frac{r^{-n+1}(1-r/m)...(1-r(n-1)/m)}{(1-1/m)...(1-(n-1)/m)}\leq\\ 
	\leq c\left(\frac{n}{\ln(n)}\right)^{\frac{\lfloor\log_{2}(r)}{\log_{2}(r)+1}\rfloor}\frac{\exp(\ln(1-r/m)+...+\ln(1-r(n-1)/m))}{\exp(\ln(1-1/m)+...+\ln(1-(n-1)/m))}=\\
	= c\left(\frac{n}{\ln(n)}\right)^{\lfloor\frac{log_{2}(r)}{\log_{2}(r)+1}\rfloor}\prod_{x=1}^{n-1}\exp\left(\ln(1-rx/m)-\ln(1-x/m)\right)
	\end{gather*}
	
	Из разложения натурального логарифма в ряд Тейлора следует, что $\ln(1-rx/m)-\ln(1-x/m)<-x(r-1)/m$ при $x\in(0;1)$. Поэтому, складывая показатели степеней у произведения экспонент, окончательно получаем:
	
	\begin{gather*}
	\Prob(\text{есть одноцветное ребро в $C$})\leq c\left(\frac{n}{\ln(n)}\right)^{\lfloor\frac{log_{2}(r)}{\log_{2}(r)+1}\rfloor}e^{-n(n-1)(r-1)/2m}\leq \frac{c}{n^{\log_{2}(r)/\log_{2}(r)+1}}<1
	\end{gather*}
	
	Cледовательно, с положительной вероятностью случайная сбалансированная раскраска $C$ является справедливой раскраской. \hyperref[lemma1]{Лемма 1} доказана.
\end{proof}

Таким образом, нам остается рассмотреть гиперграфы, в которых число вершин $m$ больше, чем $n(n-1)(r-1)\lfloor\frac{log_{2}(r)+1}{\log_{2}(r)}\rfloor/2\ln n$. 

\subsection{Алгоритм 1: построение правильной раскраски}

Следующим шагом в доказательстве \hyperref[mntheorem]{Теоремы 1} является применение модифицированной версии алгоритма перекраски А. Косточки. Алгоритм А. Косточки описан в \cite{Kost}, а наша модификация состоит в том, что, значение случайной величины, которая отвечает за то, что вершина из одноцветного ребра будет перекрашена,  фиксируется вначале и не меняется в процессе работы алгоритма.

\bigskip
Наша цель --- построить из случайной раскраски $C^{0}$ некоторую новую случайную раскраску  и показать, что она является правильной с положительной вероятностью. Для построения подобной раскраски зададим случайный порядок на множестве вершин гиперграфа $V$ c помощью отображения $\sigma:V \to [0,1]$, где $\sigma(v),v\in V$ --- независимые случайные величины с равномерным распределением на $[0,1]$. Если $\sigma(v)<p$, где $p$ --- некоторый параметр нашей конструкции, то вершину $v$ будем называть свободной. Пусть $x=\lfloor\log_{2}r\rfloor$.

\bigskip
Предположим, что в раскраске $C^{0}$ есть одноцветные ребра. Для исправления ситуации мы используем следующий алгоритм перекраски:\label{formula}

\bigskip
Этап $l,0< l\leq  x.$ 
Для каждой вершины $v$ проверяем выполнимость двух условий:

\begin{enumerate}
	\item она никогда не меняла свой цвет и является свободной, \label{1}
	\item в текущий раскраске имеется инцидентное $v$ одноцветное ребро $A, v\in A$ некоторого цвета $\alpha\in\{1,\ldots,r\}$ , и никакая из его вершин не была перекрашена на этапе $l$.\label{2}
\end{enumerate}

Если выполнены оба условия, перекрашиваем  вершину $v$ в цвет $(\alpha+2^{l-1})({\rm mod}\; r)$. В этом случае будем говорить, что перекрашенная вершина $v$ обвиняет ребро $A$. 

Если какое-то из условий \ref{1}.-\ref{2}. не выполняется, то переходим к следующей вершине. Если мы перебрали все вершины, то переходим на этап $(l+1)$.

\bigskip
Отметим, что в рамках процедуры перекраски каждая вершина меняет цвет не более одного раза, поэтому алгоритм не может работать бесконечно и обязательно остановится. 

\subsection{Алгоритм 2: восстановления равенства мощностей цветовых классов}

\bigskip
Мощности цветовых классов могут отличаться от $m/r$. Определим для каждого цветового класса $K_{i}$ неотрицательные целые числа $ex_{i}$ и $sh_{i}$, где $ex_{i}$ --- величина избытка, т.е. на сколько вершин цвета $r_{i}$ больше чем $m/r$, аналогично для недостатка. Ясно что, если $ex_{i}>0$, то $sh_{i}=0$, и наоборот.

Выберем случайно в каждом цветовом классе $K_{i}$ подмножество вершин $V_{i}$, размера $q$. Значение параметра $q$ определим позже. А пока предположим, что $q>2ex_{i}$ для любого $i$.

\bigskip
\begin{algorithm}[H]\label{formula2}

	\KwData{набор чисел $ex_{i}$ и $sh_{i}, i=1,2,...,r.$}
	\For{$(i=1;i<r;i++)$}{
		\If{$(sh_{i}!=0)$}{
			\{берем минимальное $t: ex_{1}+ex_{2}+...+ex_{t}\geq sh_{i}$ 	\;
			В каждом множестве $V_{s}, s<t$ перекрашиваем в цвет $i$ первые $ex_{s}$ вершин. А в последнем множестве $V_{t}$ перекрашиваем в цвет $i$ первые $sh_{t}-(ex_{1}+ex_{2}+...+ex_{t-1})$ вершин.  	
				
		}
		{$ex_{1}=0,ex_{2}=0,...,ex_{t}=ex_{t}-(sh_{t}-(ex_{1}+ex_{2}+...+ex_{t-1})).$\}
			
		}
	}
\end{algorithm}

\bigskip
\textbf{Комментарии:} 

\begin{itemize}

\item Шаг $1$. Пусть цвет $i$ --- это первый цвет, который в недостатке.
Берем минимальное $t: ex_{1}+ex_{2}+...+ex_{t}\geq sh_{i}.$
В каждом множестве $V_{s}, s<t$ перекрашиваем в цвет $i$ первые $ex_{s}$ вершин. А в последнем множестве $V_{t}$ перекрашиваем в цвет $i$  первые $sh_{t}-(ex_{1}+ex_{2}+...+ex_{t-1})$ вершин.  После перекраски мощности цветовых классов  $K_{1},...,K_{t-1},K_{i}$ становятся равными $m/r$. Теперь цвета $1,...,t-1$ больше не нужны и мы кладем $ex_{1}=0,ex_{2}=0,...,ex_{t}=ex_{t}-(sh_{t}-(ex_{1}+ex_{2}+...+ex_{t-1}))$. На этом шаг $1$ заканчивается.

\item Шаг $2$. Берем следующий цвет, который в недостатке. Проделываем тоже самое, что и в шаге $1$. Множества из которых мы теперь набираем вершины отличаются от $V_{1},...,V_{t-1}$, за исключением  множества $V_{t}$. 
\end{itemize}

Ясно, что \hyperref[formula2]{Алгоритм 2} сделает все цветовые классы равные $m/r$. Если при этом, мы сможем выбирать вершины для перекраски таким образом, чтобы не появлялись новые одноцветные ребра, то мы получим справедливую раскраску.

\section{$T$-деревья}

Обозначим через $C^{1}$ раскраску, которая получилась после работы \hyperref[formula]{Алгоритма 1}, а через $C^{2}$ --- финальную раскраску, т.е. раскраску после работы \hyperref[formula2]{Алгоритма 2}. Нас интересует количество одноцветных ребер, которые получились в раскрасках $C^{1}$ и $C^{2}$. 

\bigskip
Начнем с одноцветных ребер в раскраске $C^{1}$. Обозначим через $A$ одно из подобных одноцветных ребер некоторого цвета $\alpha$. Яcно, что в силу алгоритма перекраски каждая вершина $v$ ребра $A$ в раскраске $C^0$ могла быть только следующих цветов: $\alpha,\alpha-2^0,\alpha -2^2,...,\alpha-2^{k-1}({\rm mod}\; r)$. Предположим, что $\{i^A_{1},i^A_{2},...,i^A_{s}\}$ --- это цвета, которые были у вершин ребра $A$ в  $C^0$. Определим через  $a_{i^A_{1}},a_{i^A_{2}},...,a_{i^A_{s}}$ набор вершин ребра $A$, где каждая вершина $a_{i^A_{k}}$ обладает самым большим весом среди всех  вершин цвета $i^A_{k}$ ребра $A$. Для сокращения записи, будем называть такой набор вершин  доминантным  набором --- $Dominant(A)$ ребра $A$, а вершины набора доминантными.

\bigskip
Начнем построение конфигурации ребер $H$, которую мы назовем $T$-\emph{деревом} с корнем $A$. 

\begin{itemize}
	\item В качестве корня мы возьмем ребро $A$, а его потомками будут все ребра $B$, которые обвиняют доминантные вершины $a_{i^A_{1}},a_{i^A_{2}},...,a_{i^A_{s}}$ (по одному ребру для каждой вершины).
	\item Далее, в каждом ребре $B$ есть свой набор цветов $\{i^B_{1},i^A_{2},...,i^B_{t}\}$ и соответствующий ему доминантный набор вершин  $b_{i^B_{1}},b_{i^B_{2}},...,b_{i^B_{t}}$, которые были перекрашены до того, как ребро $B$ стало одноцветным. Подобные вершины обязаны обвинять некоторые новые ребра $C$, иначе ребро $B$ не могло бы стать одноцветным и, в свою очередь, никто не смог бы его обвинить. Добавим подобные ребра $C$ в качестве потомков ребра $B$
	\item Продолжим процесс построения, пока будет возможно.
\end{itemize} 

\bigskip
В результате мы получим  $T$-дерево, вершинами которого выступают ребра гиперграфа $H$, а связь определяется отношениями обвинения. Листьями получившегося  $T$-дерева будут как раз те ребра гиперграфа $H$, которые являлись одноцветными в исходной сбалансированной случайной раскраске $C^0$. Корнем $T$-дерева является одноцветное ребро в раскраске $C^{1}$. 

\bigskip
Введем понятие $T$-поддерева с корнем $A$. Для этого рассмотрим вершину $A\in T$. Пусть $N(A)$ множество всех предков $A$ в $T$-дереве. Тогда $A$ вместе с $N(A)$ будем называть \emph{T-поддеревом}. Корнем $T$-поддерева является ребро, которое было одноцветным на некотором этапе работы \hyperref[formula]{Алгоритма 1}. Соответственно, под \emph{высотой} $h(A)$ $T$-поддерева с корнем $A$ будем понимать наибольшую длину пути из корня $A$ в лист.  

\begin{corollary}
	Пусть заданы $\sigma$ и случайная раскраска $C^{0}$. Предположим, что  \hyperref[formula]{Алгоритм 1} не сработал, т.е. не  построил правильную раскраску, тогда появилось хотя бы одно $T$-дерево.
\end{corollary}

\subsection{$T$-сложные деревья}

Вернемся к рассмотрению одноцветных ребер в раскраске $C^{2}$. Зафиксируем некоторый цвет $i$ и рассмотрим все одноцветные ребра цвета $i$ в раскраске $C^{2}$. Каждое такое ребро $A$ может содержать вершины только двух типов: каждая $v\in A$

\begin{itemize}
	\item либо была цвета $i$ уже после завершения работы \hyperref[formula]{Алгоритма 1}.
	\item либо получила цвет $i$ во время работы \hyperref[formula2]{Алгоритма 2}. Обозначим через $U(A)$ множество вершин ребра $A$, имеющих тип $2$.
\end{itemize}

Рассмотрим вершины $w$, которые имеют цвет $i$ уже после \hyperref[formula]{Алгоритма 1}. Как и в предыдущем случае среди этих вершин $w$ мы можем выбрать доминантный набор вершин $Diominant(A)$, а для этого доминантного набора набор ребер $B_{1},...,B_{s}$, которые обвиняют доминантные вершины.

\bigskip
Начнем построение конфигурации ребер $H$, которую мы назовем $T$-\emph{сложным деревом}. Зафиксируем ребро $A$ и неупорядоченный набор ребер  $B_{1},...,B_{s}$. Теперь в качестве корня мы возьмем ребро $A$, а его потомками будут все ребра $B_{1},...,B_{s}$. После этого  мы  строим уже обычные $T$--поддеревья: $T(B_{1}),...,T(B_{s})$. На этом процесс построения заканчивается. Обозначим получившееся $T$--сложное дерево через $T(A,B_{1},...,B_{s})$.

\bigskip 
Рассмотрим теперь в ребре $A$ те вершины $u$, которые получили цвет $i$ во время работы \hyperref[formula2]{Алгоритма 2}. Если $u\in A\cap T(B_{t})$, то изначальный цвет такой вершины уже известен. Поэтому рассмотрим те вершины $u$, которые не попадают в такие пересечения. Согласно \hyperref[formula2]{Алгоритму 2} каждая такая вершина принадлежит некоторому подмножеству $V_{i}$ и  имеет в $C^{0}$ цвет $i$.

\subsection{Вспомогательные утверждения о $T$-деревьях}

\begin{lemma}
	$T$-дерево --- это граф без циклов, в котором для любых двух вершин  $x_{1}$ и $x_{2}$
	
	\begin{itemize}
		\item  либо $e(x_{1})\cap e(x_{2})=\emptyset$,
		\item  либо $|e(x_{1})\cap e(x_{2})|=1$ и $x_{1}$, $x_{2}$ смежные вершины $T$-дерева.
	\end{itemize}

\end{lemma}

\begin{proof}
	Докажем сначала, что в графе $T$ нет циклов. Предположим обратное: пусть $f_{1},f_{2},...,f_{k},f_{1}$ --- цикл. Пусть  $f_{1}$ начало цикла и главный цвет ребра $e(f_{1})$ равен $\alpha$. Для того чтобы цикл замкнулся на вершине $f_{1}$ ребро $e(f_{1})$ должно снова стать одноцветным. Посчитаем цвет, который должен получиться у ребра $e(f_{1})$: обозначим через $h(v)$ высоту поддерева с корнем $v$, тогда главные цвета ребер $f_{1},f_{2},...,f_{k}, f_{k+1}=f_{1}$ будут равны соответственно  $\alpha, (\alpha+2^{h(f_{2})-1})({\rm mod}\; r),..., (\alpha+2^{h(f_{2})-1}+...+2^{h(f_{k+1})-1})({\rm mod}\; r)$.
	
	C  другой стороны, в ребре $e(f_{1})$ есть перекрашенная вершина, которая согласно \hyperref[formula]{Алгоритму 1} не может уже поменять свой цвет ---  $(\alpha+2^{h(f_{2})-1})({\rm mod}\; r) $. Числа $(\alpha+2^{h(f_{2})-1})({\rm mod}\; r)$ и $(\alpha+2^{h(f_{2})-1}+...+2^{h(f_{k+1})-1})({\rm mod}\; r)=(\alpha+2^{h(f_{2})-1}\cdot(2^{k+1}-1))({\rm mod}\; r)$ не могут совпасть, поскольку тогда должно быть выполнено следующее сравнение по модулю $r$:
	\begin{gather*}
	2^{h(f_{2})-1} \equiv 2^{h(f_{2})-1}\cdot(2^{k+1}-1) \pmod r\\
	2^{h(f_{2})} \equiv 2^{h(f_{2})+k}\pmod r
	\end{gather*}
	Последнее не может быть выполнено, поскольку 
	$h(f_{2})+k<\lfloor\log_{2}r\rfloor$. В итоге мы получили противоречие, что $f_{1},f_{2},...,f_{k},f_{1}$ цикл.
	
	Докажем второе утверждение. Пусть сначала $x_{1}$ и $x_{2}$ смежные вершины. Тогда если в пересечение  $e(x_{1})\cap e(x_{2})$ больше одной вершины, то получается, что в $C^{0}$ есть две доминантные вершины одного цвета, чего не может быть. Пусть теперь $|e(x_{1})\cap e(x_{2})|\geq 1$ для двух несмежных вершин. Тогда, есть два ребра $f_{i}$ и $f_{j}$ (мы допускаем возможность, что  $f_{i}=f_{j}$), у которых совпадают главные цвета. Пусть их главный цвет равен $\beta$. Рассмотрим два пути:

	\begin{gather*}
	P_{1}=(C_{0}=root,C_{1},...,C_{t}=f_{i},...,C_{k})\\
	P_{2}=(C_{0}=root,\tilde{C_{1}},...,\tilde{C_{s}}=f_{i},...,\tilde{C_{l}}),
	\end{gather*}
	
	где $C_{k}$ и $\tilde{C_{l}}$ --- листья. Согласно \hyperref[formula]{Алгоритму 1}, главный цвет ребра $e(C_{0})$ равен $(\beta+2^{k-t}+2^{k-t+1}+...2^{k-1})({\rm mod}\; r)=(\beta+2^{k-t}\cdot(2^t-1))({\rm mod}\; r)$ и $(\beta+2^{l-s}+2^{l-s+1}+...+2^{l-1})({\rm mod}\; r)=(\beta+2^{l-s}\cdot(2^s-1))({\rm mod}\; r)$ одновременно. Ввиду того, что числа $2^t-1$ и $2^s-1$ нечетные при $s,t>1$, сравнение выполнено только при $s=t$ и $l=k$. Но это противоречит \hyperref[formula]{Алгоритму 1}, так как у корня $T$-дерева будут две доминантные вершины одного цвета.
\end{proof}

\begin{corollary}
	Если в $T$-дереве известен итоговый цвет $\alpha$ корня $A$, то изначальные цвета всех доминантных вершин гиперграфа $H$, входящих в $T$-дерево, однозначно определяются по структуре графа $T$.	
\end{corollary}

\begin{lemma}
	Из ребер гиперграфа $H$ можно составить не более, чем $m\cdot\binom{|E|}{m}$ $T$--деревьев размера $m$.
\end{lemma}

\begin{proof}
	Возьмем произвольный неупорядоченный набор из $m$ ребер гиперграфа $H$. Выберем среди одно ребро, которое будет соответствовать корню $A$. Обозначим его через $A$. 
	Среди оставшихся ребер рассмотрим все такие ребра --- $B_{1},...,B_{s}$, которые пересекаются с ребром $A$. Добавим их в качестве предков  $A$. Далее, среди оставшихся ребер ищем те, которые смежны с ребрами $B_{1},...,B_{s}$, они будут потомками вершин $B_{1},...,B_{s}$. Продолжая действовать  таким образом мы в итоге получим граф $G$. Если он удовлетворяет условию леммы 1 и в нем $m$ вершин, то мы построили $T$-дерево, иначе делаем вывод, что из данного набора ребер нельзя составить $T$-дерево. Таким образом, число $T$-деревьев не превосходит $m\cdot\binom{|E|}{m}$.
\end{proof}

\begin{lemma}
	Из ребер гиперграфа $H$ можно составить не более, чем $\binom{|E|}{m}m2^{m-1}$ $T$-сложных деревьев размера $m$.
\end{lemma}

\begin{proof}
	Зафиксируем число $s$ --- число предков первого порядка у вершины $A$. Возьмем произвольный неупорядоченный набор из $m$ ребер гиперграфа $H$. Выберем среди них ребро, которое будет соответствовать корню $A$, среди оставшихся ребер выберем ребра, которые будут соответствовать предкам $B_{1},...,B_{s}$. Это можно сделать не более, чем $m\binom{m-1}{s}$ способами. Далее, для каждого $T$-поддерева $T(B_{k}), k=1,2,...,s$ будем набирать ребра так как мы делали в лемме 3. Таким образом, общее число $T$-сложных деревьев не превосходит $\binom{|E|}{m}m\sum_{s=0}\binom{m-1}{s}$.
\end{proof}

\section{Оценка числа одноцветных ребер, образовавшихся после работы \hyperref[formula]{Алгоритма 1}} 

Во всех дальнейших вычислениях мы будем предполагать, что есть некоторый $n$-однородный гиперграф $H$, в котором $|E|\leq c\left(\frac{n}{\ln n}\right)^{\lfloor \log_{2}(r)/\log_{2}(r)+1\rfloor} r^{n-1}$, a число цветов $r\leq\sqrt{\frac{\ln n}{\tilde{c}(\ln \ln n)^3}}$.

\begin{lemma}\label{lemma5}
	Пусть $\sigma$ и $C^{0}$ заданы случайно, тогда с положительной вероятностью \hyperref[formula]{Алгоритм 1} построит правильную раскраску $C^{1}$ в $r$ цветов.
\end{lemma}

\begin{proof} 
	Рассмотрим событие заключающееся в том, что \hyperref[formula]{Алгоритма 1} не сработал, когда $\sigma$ и $C^{0}$ были заданы случайно. Согласно следствию 1, это событие могло произойти только тогда, когда появилось хотя бы одно $T$-дерево. Мы переберем все возможные $T$-деревья, оценивая для каждого $T$-дерева вероятность события, заключающегося в том, что в результате процесса случайной перекраски нашелся набор ребре гиперграфа $H$, который образовал это $T$-дерево. 
	
	\bigskip
	Итак, пусть мы зафиксировали некоторое $T$-дерево с корнем $A$. Пусть $\alpha$ --- цвет ребра $A$ в раскраске $C^{1}$. Предположим, что доминантный набор вершин ребра $A$ состоит из $s$ вершин, которые обвиняют ребра $B_{1},...,B_{s}$. Согласно следствию 2 изначальные цвета этих $s$ вершин однозначно определяются по структуре графа $T$. Обозначим через $x_{1},...,x_{s}$ соответствующие веса вершин доминантного набора ребра $A$. Теперь, согласно \hyperref[formula]{Алгоритму 1} цвет любой $v\in A: v\notin\mathcal{D(A)}$ 
	
	\begin{itemize}
		\item либо равен $\alpha$
		\item либо равен цвету одной из доминатных вершин $\{a_{i_{j}}^{A}:\sigma(v)\leq \sigma(a_{i_{j}}^{A})\}$
	 \end{itemize} 
 
 Рассмотрим теперь ребро $B_{1}$. Пусть у $B_{1}$ ровно $t$ доминантных вершин, а их веса равны $y_{1},...,y_{t}$. Тогда цвет любой $v\in B_{1}: v\notin\mathcal{D}(B_{1})$ равен либо главному цвету ребра $B_{1}$, либо равен цвету одной из доминантных вершин $\{b_{i_{j}}^{B_{1}}:\sigma(v)\leq\sigma(b_{i_{j}}^{B_{1}})\}$.Повторяя рассуждения для всех вершин $T$-дерева, мы ограничим множество цветов, которые могут быть у вершин гиперграфа $H$.
	
    \bigskip
    Тем не менее вероятность появления $T$-дерева сильно зависит от номера этапа $l$ на котором завершилось образование $T$-дерева. Поэтому мы рассмотрим два случая и проведем вычисления для каждого случая отдельно. 

\begin{enumerate}
	\item[\bf 1.] Образовалось дерево за $l<x=\lfloor\log_{2}r\rfloor$ этапов.
	 
	Обозначим данное событие через $\mathcal{A}$.
	В этом случае все вершины $v\in A$ цвета $\alpha$ имееют вес больше $p$.
	Пользуясь леммой 3 о числе $T$-деревьев мы можем оценить вероятность событие $\mathcal A$ следующим образом: 

\begin{gather*}
\Prob(\mathcal A)\leq r\sum_{m=1} m\cdot|E|^{m}\underbrace{\iint...\int}_{[0;p]^{m-1}} \left(\frac{x_{1}}{r}+...\frac{x_{s}}{r}+\frac{1-p}{r}\right)^{n-s}\cdot\\ \cdot\left(\frac{y_{1}}{r}+...\frac{y_{t}}{r}+\frac{1-x_{1}}{r}\right)^{n-t-1}\cdot...\cdot\left(\frac{1}{r}\right) ^{m-1}
\end{gather*}
 
 Оценим числитель подынтегрального выражения:
 
 \begin{gather*} 
 \left(x_{1}+...x_{s}+1-p\right)^{n-s} \cdot\left(y_{1}+...+y_{t}+1-x_{1}\right)^{n-t-1}\cdot...\cdot\leq
 \\\leq\left[(x_{1}+...x_{s}+1-p)\left(y_{1}+...+y_{t}+1-x_{1}\right)\cdot...\cdot\right]^n\cdot(1-p)^{-s}\cdot(1-p)^{-t-1}\cdot...\cdot\leq
 \\\leq\left(1-\frac{p}{m}\right)^{mn}\cdot(1-p)^{-2(m-1)}
 \end{gather*}
 
  С учетом полученной оценки на числитель,
   
 \begin{gather*} 
 \Prob(\mathcal A)\leq r\sum_{m=1} m\cdot |E|^{m}p^{m-1}\left(\frac{1}{r}\right)^{(n-1)m+1}\left(1-\frac{p}{m}\right)^{mn}\cdot(1-p)^{-2(m-1)}\leq\\
 \leq\sum_{m=1} \left[\left(\frac{2cn}{\ln n}\right)^{\lfloor\frac{ \log_{2}(r)}{log_{2}(r)+1}\rfloor}\right]^{m}p^{m-1}\left(1-\frac{p}{m}\right)^{mn}\cdot(1-p)^{-2(m-1)}\leq\
 \\|\text{ $p=\gamma\frac{\ln n}{n}$}|
 \\
 \leq 2c\sum_{m=1}\left(\frac{n}{\ln n}\right)^{\lfloor\frac{ \log_{2}(r)}{log_{2}(r)+1}\rfloor}\left(\frac{\ln n}{n}\right)^{\frac{m-1}{\log_{2}(r)+1}}\frac{1}{n^{\gamma}}\leq \frac{2cn^{1-\gamma}}{\ln n}\sum_{m=1}\exp\left(-\frac{\ln\frac{n}{\ln n}}{\log_{2}(r)+1}(m-1)\right)
 \end{gather*}
 
	 Ряд $\sum_{m=1}\exp(-\alpha m)$ сходится при $\alpha\geq 1$. Таким образом, когда число цветов невелико и $\gamma\geq 1$, вероятность события $\mathcal A$ будет стремится к нулю при $n\rightarrow\infty$, при этом  $\Prob(\mathcal A)$ заведомо меньше, чем $4c$.
	 
	\item[\bf 2.] Образовалось дерево на последнем этапе \hyperref[formula]{Алгоритма 1}. $l=x=\lfloor\log_{2}r\rfloor$.
	
	Обозначим данное событие через $\mathcal{B}$. В этом случае мы не можем ничего сказать о  вершинах $v\in A$ цвета $\alpha$. Однако, за счет того, что $T$-дерево построилось в конце, мы можем утверждать, что в нем много вершин, а именно $m\geq\lfloor\log_{2}r\rfloor$.
	
	\begin{gather*}
	\Prob(\mathcal B)\leq r\sum_{m>\lfloor\log_{2}r\rfloor} m\cdot|E|^{m}\underbrace{\iint...\int}_{[0;p]^{m-1}} \left(\frac{x_{1}}{r}+...\frac{x_{s}}{r}+\frac{1}{r}\right)^{n-s}\cdot\\ \cdot\left(\frac{y_{1}}{r}+...\frac{y_{t}}{r}+\frac{1-x_{1}}{r}\right)^{n-t-1}\cdot...\cdot\left(\frac{1}{r}\right) ^{m-1}
	\end{gather*}
	
	С учетом того, что числитель подынтегрального выражения не превосходит 1,
	
	\begin{gather*} 
	\Prob(\mathcal B)\leq r\sum_{m>\lfloor\log_{2}r\rfloor}m\cdot |E|^{m}p^{m-1}\left(\frac{1}{r}\right)^{(n-1)m+1}\leq\\
	\leq\sum_{m>\lfloor\log_{2}r\rfloor} \left[\left(\frac{2cn}{\ln n}\right)^{\lfloor\frac{ \log_{2}(r)}{log_{2}(r)+1}\rfloor}\right]^{m}p^{m-1}\leq
	\\\leq 2c\sum_{m>\lfloor\log_{2}r\rfloor}\left(\frac{n}{\ln n}\right)^{\lfloor\frac{ \log_{2}(r)}{log_{2}(r)+1}\rfloor}\left(\frac{\ln n}{n}\right)^{\frac{m-1}{\log_{2}(r)+1}}\leq 2c\sum_{m=1}\exp\left(-\frac{\ln\frac{\ln n}{n}}{\log_{2}(r)+1}(m-1)\right)<4c
	\end{gather*}
	при ограничении на число цветов.
	
\end{enumerate}
\end{proof}

\subsection{Оценка на максимальный избыток и максимальный недостаток}

В этом параграфе мы получим явное соотношение на параметр $q$ из \hyperref[formula2]{Алгоритма 2}. Напомним, что мы хотим, чтобы $q\geq 2\max_{i} ex_{i}$. Поэтому следующим действием будет оценка сверху величины $ex_{i}$.

Пусть $\sigma$ и $C^{0}$ заданы случайно. Обозначим через $Rec(\alpha)$ случайную величину равную числу вершин $v$, перекрашенных в цвет $\alpha$ в результате \hyperref[formula]{Алгоритма 1}. 
Также, для каждого цветового класса $K_{\alpha}$ рассмотрим случайную величину $X_{K_{\alpha}}$ , равную число вершин цвета $\alpha$ в $C^{0}$.  Ясно, что $X_{K_{\alpha}}$ имеет биномиальное распределение $Bin(m,1/r)$.

Таким образом, суммируя вышесказанное, заметим, что для каждого цвета $\alpha$, который в избытке, выполнено, что 

 \begin{gather*}
 ex_{\alpha}\leq Rec(\alpha)+\left(X_{K_{\alpha}}-\frac{m}{r}\right). 
 \end{gather*}

Используя неравенство Чернова, которое утверждает, что для случайной величины $X\sim Bin(n,p)$

\begin{gather*}
\Prob(X > EX + t)\leq\exp\left(-\frac{t^2}{2(EX +t/3)}\right)
\end{gather*}

с $t =\sqrt{\frac{2m\ln r/c}{r}}$, получаем оценки

\begin{gather*}
\Prob\left(\exists\alpha:  X_{K_{\alpha}} >\frac{m}{r} + t\right)\leq r\exp\left(-\frac{t^2}{2(\frac{m}{r}+t/3)}\right)<\frac{cr}{r}=c
\end{gather*}

Получим теперь оценку на величину $Rec(\alpha)$. Для этого заметим, что каждой $v$, перекрашенной в цвет $\alpha$, соответствует некоторое $T$-поддерево --- $T(A)$. Соответствие заключается в том, что вершина $v$ обвиняет ребро $A$. При этом, доминантный цвет ребра $A$ в $T$-поддереве $T(A)$ однозначно определяется по структуре графа $T$. Действительно, чтобы вершина $v$ перекрасилась в цвет $\alpha$ необходимо, чтобы доминантный цвет ребра $A$ был равен в точности $(\alpha-2^{h(A)-1})({\rm mod}\; r)$, где $h(A)$ --- высота дерева $T$. Таким образом, нам остается оценить число $T$-поддеревьев, у которых доминантный цвет корня заранее определен.

По аналогии с уже проделанными вычислениями для $T$-деревьев, математическое ожидание числа  $T$-поддеревьев, а следовательно, и $\sf{E Rec(\alpha)}$ можно оценить следующим образом:

\begin{gather*}
\text{\sf{E}} Rec(\alpha)\leq\sum_{m=1} p^{m-1}m\cdot\binom{|E|}{m}\left(\frac{1}{r}\right)^{(n-1)m+1}
\end{gather*}

Для сокращения записи обозначим через $k$ следующее выражение : $\left(\frac{n}{\ln(n)}\right)^{\lfloor \log_{2}(r)/\log_{2}(r)+1\rfloor}$. Тогда, при $p=\gamma\frac{\ln n}{n}$ и $r<\left(\frac{n}{\ln n}\right)^{\ln 2}$.

\begin{gather*}
\sum_{m=1} p^{m-1}m\cdot\binom{|E|}{m}\left(\frac{1}{r}\right)^{(n-1)m+1}\leq \frac{2c}{r}\sum_{m=1}\left(\frac{n}{\ln n}\right)^{\lfloor\frac{ \log_{2}(r)}{log_{2}(r)+1}\rfloor}\left(\frac{\ln n}{n}\right)^{\frac{m-1}{\log_{2}(r)+1}}\leq \frac{4ck}{r}
\end{gather*}

Окончательно получаем, что с положительной вероятностью для каждого цвета $\alpha$ 

\begin{gather*}
Rec(\alpha)\leq \frac{k}{2}.
\end{gather*}

Положим параметр $q$ равным 

\begin{gather}
q=\left(\frac{n}{\ln(n)}\right)^{\lfloor \log_{2}(r)/\log_{2}(r)+1\rfloor}+2\sqrt{\frac{2m\ln r/c}{r}}.
\end{gather}

Таким образом, с положительной вероятностью 
\begin{gather}
max_{i} ex_{i}\leq q/2.
\end{gather}

А повторяя предыдущие рассуждения для $sh_{i}$, можно получить, что с положительной вероятностью 
\begin{gather}\label{sh_i}
max_{i} sh_{i}\leq q/2.
\end{gather}
 
 \section{Оценка числа одноцветных ребер, образовавшихся после работы \hyperref[formula2]{Алгоритма 2}}
 
В предыдущей главе мы доказали, что с большой вероятностью  после завершения работы \hyperref[formula]{Алгоритма 1} все ребра гиперграфа $H$ будут неодноцветными. Поэтому предположим, что все одноцветные ребра, которые мы имеем в финальной раскраске $C^{2}$, появились во время работы \hyperref[formula2]{Алгоритма 2}. В силу данного предположения, каждое такое одноцветное ребро имеет хотя бы одну вершину, которая поменяла свой цвет во время работы \hyperref[formula2]{Алгоритма 2}. 

Нам удобно ввести следующее обозначение:
Пусть $\sigma$ и $C^{0}$ заданы случайно. Обозначим через $X$ случайную величину равную числу одноцветных ребер в раскраске $C^{2}$.

 \begin{lemma}
 Пусть  $\tilde{p}=\frac{q}{m/r-q/2}$, где $q$ --- параметр из \hyperref[formula2]{Алгоритма 2}.
 Тогда,
  
 \begin{gather*}
 \text{\sf E} X<ck(1+\tilde{p}(r-1))^n.
 \end{gather*}
 
 \end{lemma}
 
 \begin{proof} 
 
  Как и прежде, зафиксируем некоторое $T(A,T(B_{1}),...,T(B_{s}))$ --- 
 
 $T$-сложное дерево с корнем $A$ и потомками первого порядка: $B_{1},...,B_{s}, s\in\{1,...,\log_{2}r\}$. Обозначим через $t_{i}$ число вершин в пересечении $A\cap T(B_{i})$, а через $m_{i}$ --- размер $T$-поддерева $T(B_{i})$. Пусть $\alpha$ цвет ребра $A$ в раскраске $C^{2}$. 
  
  Как и в случае $T$-деревьев, по структуре графа $T$ однозначно определяются цвета всех доминантных вершин в раскраске $C^{0}$. Заметим, что $T(B_{1}),...,T(B_{s})$ являются неперсекающимися $T$-поддеревья, и поэтому для вершин гиперграфа $H$, попадающих в эти $T$-поддеревья выполняются все соотношения из Леммы \ref{lemma5}.
 
 Рассмотрим теперь вершины ребра $A$: 
 
 \begin{enumerate}
	\item Если $u\in A\cap\left(\cup_{t} T(B_{t})\right)$, то изначальный цвет такой вершины уже известен.
	\item Если $w\in A\setminus\left(\cup_{t} T(B_{t})\right)$, то она либо цвета $\alpha$ , либо  она попала в одно из множеств $V_{i}, i=1,...,r$ и имеет в $C^{0}$ цвет $i$. 
\end{enumerate}

Для удобства введем обозначения для некоторых событий. Обозначим через $\mathcal{F}_A(n-t)$, событие, заключающееся в том, что вершины $w$ корня $A$, покрашены так, что $T(A,T(B_{1}),...,T(B_{s}))$ --- $T$-сложное дерево. Соответственно, через $\mathcal{F}_{B_{i}}(t_{i})$ --- событие, заключающееся в том, что вершины $u$ раскрашены соответствующим образом.
Тогда,

\begin{gather}
\Prob(T(A,B_{1},...,B_{s}))\leq\left(\prod_{i=1}^{s}\Prob(T(B_{i}))\right)\left(\prod_{i=1}^{s}\Prob(\mathcal{F}_{B_{i}}(t_{i}))\right)\Prob(\mathcal{F}_A(n-t))
\end{gather}

Выпишем оценки для каждого множителя:

\begin{gather}
\Prob(T(B_{i}))\leq\left(\frac{1}{r}\right)^{(n-1)m_{i}+1}p^{m_{i}-1},
\\
\Prob(\mathcal{F}_{B_{i}}(t_{i}))\leq t_{i}\cdot p\cdot\tilde{p}^{(t_{i}-1)}=r^{-(t_{i}-1)}\cdot(r\tilde{p})^{(t_{i}-1)}\cdot t_{i}\cdot p,
\\
\Prob(\mathcal{F}_A(n-t))\leq r\left(\frac{1+\tilde{p}(r-1)}{r}\right)^{n-t}\leq r^{t+1-n}\left(1+\tilde{p}(r-1)\right)^{n}
\end{gather}

Оценки $(3)$ и $(4)$ получены из того факта, что если подмножество вершин $V_{i}$ размера $q$ выбирается случайно, то для любого набора  $\{v_{i_{1}},...,v_{i_{l}}\}$ совместная вероятность $\Prob(\{v_{i_{1}},...,v_{i_{l}}\}\in V_{i})\leq\prod_{t}\Prob(v_{i_{t}}\in V_{i}\leq\prod_{t}\left(\frac{q}{m/r-q/2}\right)$, где $m/r-q/2$ --- минимально возможный размер цветового класса $K_{i}$, из которого выбирается подмножество $V_{i}$(см.\ref{sh_i} ). Отсюда, в частности, следует, что

 \begin{gather*}
\tilde{p}r=\frac{r\cdot q}{m/r-q/2}\leq\frac{r\cdot \left(\frac{n}{\ln(n)}\right)^{\lfloor \log_{2}(r)/\log_{2}(r)+1\rfloor}+2r\sqrt{\frac{2m\ln r/c}{r}}}{m/r-q/2}\rightarrow 0
\end{gather*}

при $n\rightarrow\infty$ и $r<\left(\frac{n}{\ln n}\right)^{\ln 2}$.
 
Подставим в $(1)$ оценки $(2),(3)$ и $(4)$.

\begin{gather*}
\Prob(T(A,B_{1},...,B_{s}))\leq r\left(\frac{1}{r}\right)^{(n-1)m+1}\cdot p^{m-1}\cdot(1+\tilde{p}(r-1))^n\cdot\prod_{i=1}^{s} (r\tilde{p})^{(t_{i}-1)}\cdot t_{i}
\end{gather*}

Рассмотрим функцию $f(x)=(r\tilde{p})^{(x-1)}\cdot x$ на $[1;\infty)$. Ее можно переписать в виде $f(x)=\exp(-\beta(x-1))\cdot x$, где $\beta=\ln\left(\frac{1}{r\tilde{p}}\right)>1$. Функция $f(x)$ убывает на $[1;\infty)$, так как ее  производная $f'(x)=(1-\beta x)\exp(-\beta(x-1))$ равна нулю при $x=1/\beta<1$ и  отрицательна при $x>1/\beta$. Поэтому, наибольшее значение $f(x)$ на $[1;\infty)$ равно 1 при $x=1$.

С учетом полученной оценки на $f(x)$:

\begin{gather*}
\Prob(T(A,B_{1},...,B_{s}))\leq p^{m-1}\cdot (1+\tilde{p}(r-1))^n\left(\frac{1}{r}\right)^{(n-1)m}
\end{gather*}

Суммируя по всем $m$ произведения $\Prob(T(A,B_{1},...,B_{s}))m\cdot\binom{|E|}{m} 2^{m-1}$,

\begin{gather*}
\text{\sf E} X\leq\sum_{m=1} p^{m-1}m\cdot\binom{|E|}{m}\cdot 2^{m-1}\cdot (1+\tilde{p}(r-1))^n\left(\frac{1}{r}\right)^{(n-1)m}\leq ck(1+\tilde{p}(r-1))^n.
\end{gather*}

\end{proof}
  
\begin{corollary}
  	Пусть раскраска $C^{0}$ и отображение $\sigma$ заданы случайно, тогда с положительной вероятностью одноцветных ребер в раскраске $C^{2}$ будет меньше, чем $q/2$.
\end{corollary}

\begin{proof}
	Согласно лемме 6, 
	\begin{align*}
	\text{\sf E} X\leq ck(1+\tilde{p}(r-1))^n,
    \end{align*}
  поэтому с положительной вероятностью $$X<\frac{k(1+\tilde{p}(r-1))^n}{2}$$
  Оценим $2X$:
\begin{align*}
2X\leq
&k(1+\tilde{p}(r-1))^n\leq k\exp\{n\tilde{p}(r-1)\}=k\exp\left\{n(r-1)\frac{q}{m/r-q/2}\right\}\\
&\mbox{(используя явные соотношения (1) на $q$ и $k$, а также оценку на $m$ из леммы 1)} \\
&\leq k\exp\left\{n(r-1){\left(k+2\sqrt{2(\ln r/c)m/r}\right)\over m/r-q/2}\right\}\leq k\exp\left\{n(r-1){\left(4\sqrt{2(\ln r/c)m/r}\right)\over m/r-q/2}\right\}\leqslant\notag \\ 
&\leq k\exp\left\{4(r-1)\sqrt{2(\ln n) 2\ln r/c} \right\}
\leqslant k\exp\left\{(\ln n)\cdot 8r\sqrt{{\ln r/c\over \ln n}}\right\}\notag\\
&\mbox{(предположим, что $\frac{ 8r\sqrt{\ln r/c}}{\sqrt{\ln n}}\leq\frac{1}{\log_{2}r+1}$  )}\notag\\
&\leqslant k\cdot\exp\left\{{\ln n\over \log_{2}r+1}\right\}\leq k\cdot n^{\frac{1}{\log_{2}r+1}}=\frac{n}{(\ln n)^{\frac{\log_{2}r}{\log_{2}r+1}}}\leq q=\left(k+2\sqrt{\frac{2m(\ln r/c)}{r}}\right)\notag.
\end{align*}
Осталось показать, что действительно верно соотношение
\begin{gather*}
\frac{8r\sqrt{\ln r/c}}{\sqrt{\ln n}}\leq\frac{1}{\log_{2}r+1},
\end{gather*}
 когда $r\leq\sqrt{\frac{\ln n}{\tilde{c}(\ln \ln n)^3}}$
 
\begin{align*}
\frac{8r(\log_{2}r+1)\sqrt{\ln r/c}}{\sqrt{\ln n}}&\leq\frac{8\cdot \sqrt{\frac{\ln n}{\tilde{c}(\ln \ln n)^3}}(\ln\ln n+1)\sqrt{\ln\ln n+\ln 1/c}}{\sqrt{\ln n}}\leq\notag\\
&\mbox{(подставляя оценку на $r$)}\notag\\
&\leq 8\cdot \sqrt{\frac{1}{\tilde{c}(\ln \ln n)^3}}(\ln\ln n+1)\sqrt{\ln\ln n\cdot\ln 1/c}<1\\
&\mbox{(уже при  $\tilde{c}\geq 64\ln\frac{1}{c}$)}\notag\
\end{align*}
\end{proof}

 \section{Доказательство \hyperref[mntheorem]{Теоремы 1}}
 
 Пусть $H=(V,E)$ $n$-однородный гиперграф $H$, в котором 
 
 $|E|\leq c\left(\frac{n}{\ln n}\right)^{\lfloor \log_{2}(r)/\log_{2}(r)+1\rfloor} r^{n-1}$, a число цветов $r\leq\sqrt{\frac{\ln n}{\tilde{c}(\ln \ln n)^3}}$. 
 
 Докажем, что $H$ можно справедливо раскрасить в $r$ цветов.
 Согласно лемме 1, мы можем считать что число вершин $m>\frac{n^2(r-1)}{2\ln n}$. Рассмотрим случайную раскраску $C^{0}$ и отображения $\sigma:V \to [0,1]$, где $\sigma(v),v\in V$ --- независимые случайные величины с равномерным распределением на $[0,1]$. Применим к гиперграфу $H$ \hyperref[formula]{Алгоритм 1 } для построение правильной раскраски. \hyperref[formula]{Алгоритм 1}, согласно Лемме 5 построит из $C^{0}$ некоторую правильную раскраску $C^{1}$ с вероятностью не меньше, чем $1-8c$. 
 
 После работы \hyperref[formula]{Алгоритма 1} мощности цветовых классов $K_{i}$ могут отличаться от $m/r$, но с вероятностью не меньше, чем $1-10c$ выполнено, что $q/2\leq |K_{i}|-m/r\leq q/2$. Выберем случайно в каждом цветовом классе $K_{i}$ подмножество вершин $V_{i}$ размера $q$ и применим \hyperref[formula2]{Алгоритм 2}. \hyperref[formula2]{Алгоритм 2} сделает все цветовые классы равными $m/r$. Если при этом, мы сможем выбирать из множеств $V_{i}$ вершины для перекраски таким образом, чтобы не появлялись новые одноцветные ребра, то мы получим справедливую раскраску.
 
 Следствие 3 утверждает, что с вероятностью не меньше, чем $1-2c$ число всех одноцветных ребер будет меньше, чем $q/2$. Тогда если мы не будем брать по одной вершине из каждого такого ребра, то в каждом $V_{i}$ останется еще хотя бы $q/2$ вершин. Этого числа достаточно, чтобы \hyperref[formula2]{Алгоритм 2} уровнял мощности цветовых классов.
 
 Выбор параметров: вероятность того, что у нас не получилось справедливой раскраски не превосходит $8c+10c+2c=20c<1$ уже при $c<0.05$.
\hyperref[mntheorem]{Теорема 1} доказана.

\renewcommand{\refname}{Список литературы}
 \begin{thebibliography}{99}\label{bibliography}

\bibitem{Kost} A. Kostochka, ``Coloring uniform hypegraphs with few colors'', \emph{Random Structures and Algorithms}, \textbf{24} (2010), 1--10.
  
\bibitem{Erd2} P. Erd\H{o}s , ``Theory of Graphs and Its Applications” (M. Fieldler, Ed.) Czech. Acad. Sci. Publ., Prague, \textbf{9} (1964), 159.

\bibitem{HajSem} A. Hajnal, E. Szemeredi, ``Proof of a conjecture of P. Erd\H{o}s'', \emph{Combinatorial theory and its applications}, North-Holland, London, \textbf{II} (1969), 601-–623

\bibitem{KierKost} H. A. Kierstead, A. V. Kostochka, ``A short proof of the Hajnal-Szemeredi Theorem on equitable coloring'', \emph{Combinatorics, Probability and Computing}, \textbf{17} (2008), 265–270.

\bibitem{KKMS} A. V. Kostochka, M. Mydlarz, E. Szemeredi, H.A. Kierstead, ``A fast algorithm for equitable coloring'', \emph{Combinatorica}, \textbf{30(2)} (2010), 217--224.

\bibitem{Shab} D. A. Shabanov "Equitable two-colorings of uniform hypergraphs"/ European Journal of Combinatorics, т.43 (2015), с. 185-203

\bibitem{Akol} И. А. Аколзин "О справедливых раскрасках простых гиперграфов"/ ТРУДЫ МФТИ, т.9, №4 (2017), с. 161--173

 		
 \end{thebibliography}
 

\end{document}
